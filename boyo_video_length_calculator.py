class BoyoVideoLengthCalculator:
    """
    Calculates video generation parameters and trim positions based on target length.
    Uses hardcoded lookup table for reliable frame counts and trim positions.
    """
    
    @classmethod
    def INPUT_TYPES(cls):
        return {
            "required": {
                "target_seconds": ("INT", {"default": 5, "min": 5, "max": 60, "step": 5}),
            }
        }
    
    RETURN_TYPES = ("INT", "INT", "STRING", "STRING")
    RETURN_NAMES = ("total_frames", "loops_needed", "trim_positions", "info")
    FUNCTION = "calculate_video_params"
    CATEGORY = "Boyo/Video"
    
    def calculate_video_params(self, target_seconds):
        """
        Calculate video parameters from lookup table.
        Returns total frames, loops needed, and trim positions as comma-separated string.
        """
        
        # Hardcoded lookup table - adjust based on test results
        # Format: seconds -> (frames_per_chunk, total_frames, trim_frame_lists)
        lookup_table = {
            5:  (94, 94, []),  # No trims for single chunk
            10: (94, 188, ["94,95,96,97,98,99,100,101,102,103,104,105,106"]),  # Trim 13 frames from junction
            15: (94, 282, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200"]),  # Two junctions
            20: (94, 376, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294"]),  # Three junctions
            25: (94, 470, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388"]),
            30: (94, 564, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482"]),
            35: (94, 658, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576"]),
            40: (94, 752, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576", "658,659,660,661,662,663,664,665,666,667,668,669,670"]),
            45: (94, 846, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576", "658,659,660,661,662,663,664,665,666,667,668,669,670", "752,753,754,755,756,757,758,759,760,761,762,763,764"]),
            50: (94, 940, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576", "658,659,660,661,662,663,664,665,666,667,668,669,670", "752,753,754,755,756,757,758,759,760,761,762,763,764", "846,847,848,849,850,851,852,853,854,855,856,857,858"]),
            55: (94, 1034, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576", "658,659,660,661,662,663,664,665,666,667,668,669,670", "752,753,754,755,756,757,758,759,760,761,762,763,764", "846,847,848,849,850,851,852,853,854,855,856,857,858", "940,941,942,943,944,945,946,947,948,949,950,951,952"]),
            60: (94, 1128, ["94,95,96,97,98,99,100,101,102,103,104,105,106", "188,189,190,191,192,193,194,195,196,197,198,199,200", "282,283,284,285,286,287,288,289,290,291,292,293,294", "376,377,378,379,380,381,382,383,384,385,386,387,388", "470,471,472,473,474,475,476,477,478,479,480,481,482", "564,565,566,567,568,569,570,571,572,573,574,575,576", "658,659,660,661,662,663,664,665,666,667,668,669,670", "752,753,754,755,756,757,758,759,760,761,762,763,764", "846,847,848,849,850,851,852,853,854,855,856,857,858", "940,941,942,943,944,945,946,947,948,949,950,951,952", "1034,1035,1036,1037,1038,1039,1040,1041,1042,1043,1044,1045,1046"])
        }
        
        if target_seconds not in lookup_table:
            return (0, 0, "", f"ERROR: {target_seconds} seconds not supported. Use 5-60 seconds in 5-second increments.")
        
        frames_per_chunk, total_frames, trim_lists = lookup_table[target_seconds]
        loops_needed = target_seconds // 5  # Each loop = 5 seconds
        
        # Combine all trim positions into one string
        trim_positions = "|".join(trim_lists) if trim_lists else ""
        
        info = f"Target: {target_seconds}s | Loops: {loops_needed} | Total frames: {total_frames} | Trim sections: {len(trim_lists)}"
        
        print(f"[Boyo] BoyoVideoLengthCalculator: {info}")
        
        return (total_frames, loops_needed, trim_positions, info)

# Node mappings for ComfyUI
NODE_CLASS_MAPPINGS = {
    "BoyoVideoLengthCalculator": BoyoVideoLengthCalculator
}

NODE_DISPLAY_NAME_MAPPINGS = {
    "BoyoVideoLengthCalculator": "Boyo Video Length Calculator"
}
